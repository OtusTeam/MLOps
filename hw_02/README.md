# Настройка облачной инфраструктуры для проекта по определению мошеннических транзакций

**Домашнее задание №2**  
**Курс MLOps**  
**Образовательная платформа «Otus»**

## Цель работы

В данном домашнем задании Вы познакомитесь с облачным провайдером Yandex Cloud, поработаете с сервисами Object Storage и Yandex Data Processing, создадите свой Spark-кластер и скопируете в него данные, научитесь оценивать затраты при проектировании облачной инфраструктуры.

## Описание проекта

> Наконец-то! Оформив трудоустройство и уладив все формальности с юристами компании, Вы можете приступить к работе. В первую очередь, Вас интересуют данные о транзакциях, которые были собраны за последние несколько лет. Пообщавшись с системным администратором, Вы узнаёте, что необходимая Вам информация расположена в озере данных компании в объектном хранилище, которое на время проведения работ по проекту будет Вам доступно по адресу:
> 
> `s3://otus-mlops-source-data/`
> 
> Поскольку данное хранилище предоставляется в режиме «только для чтения», то Вам потребуется перенести данные в другое, уже Ваше, хранилище для дальнейшей работы с ними, которое нужно будет предварительно создать. В качестве такого хранилища обычно используют либо S3-bucket, либо HDFS.
> 
> Также, поскольку заказчик не имеет возможности предоставить собственную вычислительную инфраструктуру для выполнения проекта, для этой цели придется использовать облачные ресурсы. Поскольку данные для анализа расположены на серверах Yandex Cloud, то логично развернуть там и кластер для их обработки.

## Требования к инфраструктуре

### Промокод

Перед выполнением работы Вы можете запросить у менеджеров Otus промокод к Yandex Cloud, позволяющий работать с ресурсами облака в течение рамках данного курса.

### Кластер Yandex Data Processing

Spark-кластер должен иметь следующие характеристики:

- **Мастер-подкластер**: класс хоста `s3-c2-m8`, размер хранилища 40 ГБ
- **Data-подкластер**: класс хоста `s3-c4-m16`, 3 хоста, размер хранилища 128 ГБ  
**Важное замечание:** Квоты на создание кластера в вашем аккаунте могут быть ограничены, поэтому если не удается создать кластер, нужно запросить у увеличение квот в поддержке Yandex Cloud.

## Задания

Решение будет ожидаться в виде репозитория/ветки на GitHub, с terraform конфигурациями и другим необходимым кодом для запуска всей системы.

### Обязательные задания

1. **Создать новый bucket в Yandex Cloud Object Storage** с использованием terraform скрипта. Примеры вы сможете найти в материалах занятия или на странице документации [Yandex Cloud](https://yandex.cloud/ru/docs/storage/tf-ref). Выложить созданный вами скрипт в GitHub репозиторий c заданием.

2. **Скопировать содержимое предоставленного хранилища** с использованием инструмента `s3cmd`. Для проверки преподавателем данный bucket необходимо сделать общедоступным, а точку доступа к нему привести в README-файле Вашего GitHub-репозитория.

3. **Создать Spark-кластер в Yandex Data Processing** с двумя подкластерами согласно указанным характеристикам. Для экономии ресурсов необходимо использовать terraform скрипт для создания и удаления кластера. Примеры вы сможете найти в материалах занятия или на странице документации [Yandex Cloud](https://yandex.cloud/ru/docs/data-proc/tf-ref). Выложить созданный вами скрипт в GitHub репозиторий c заданием.

4. **Соединиться по SSH с мастер-узлом** и выполнить на нём команду копирования содержимого хранилища в файловую систему HDFS с использованием инструмента `hadoop distcp`. Для проверки преподавателем необходимо вывести содержимое HDFS-директории в консоль, а снимок экрана с этой информацией привести в README-файле Вашего GitHub-репозитория.

5. **Оценить месячные затраты** используя тарифный калькулятор Yandex Cloud для поддержания работоспособности созданного кластера. Оценить, насколько использование HDFS-хранилища дороже, чем объектного.

### Дополнительные задания

6. **Предложить способы для оптимизации затрат** на содержание Spark-кластера в облаке и попробовать их реализовать.

7. **Изменить статус задач** на Kanban-доске в GitHub Projects в соответствии с достигнутыми результатами. Возможно, некоторые задачи нужно будет скорректировать, разделить на подзадачи или объединить друг с другом.

8. **Полностью удалить созданный кластер** с помощью команды `terraform destroy`, чтобы избежать оплаты ресурсов в период его простаивания.

## Важные замечания

### Тарификация кластера

Даже если кластер находится в выключенном состоянии, все равно облачный провайдер списывает денежные средства со счета клиента за резервирование части ресурсов. Это может привести к быстрому израсходованию денежных средств на счете!  
Не забывайте полностью удалить облачный кластер после завершения использования. Это удобно делать с помощью команд terraform.

### Мониторинг затрат

Кроме тарифного калькулятора, позволяющего делать оценку требуемых средств, на странице платежного аккаунта есть раздел с детализацией биллинга за произвольный период времени. С его помощью можно определить сумму уже потраченных средств на каждый из используемых облачных сервисов в процессе работы.

## Критерии оценки

Для получения положительной оценки за работу необходимо выполнить **задания 1-4 и 8** из вышеприведенного списка.

---

**Желаем успехов!** 