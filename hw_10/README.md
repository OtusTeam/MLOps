# Развертывание модели

**Домашнее задание №10**  
**Курс MLOps**  
**Образовательная платформа «Otus»**

## Цель работы

В данном домашнем задании Вы потренируетесь в развертывании модели в Kubernetes кластере и мониторинга метрик его работы. Вам предстоит развернуть модель в облачном Kubernetes кластере и настроить контроль метрик его состояния. Так же подготовить уведомления в случае нарушения режимов работы.

## Описание проекта

> Поздравляю! Ваша модель прошла тестирование и руководство приняло решение разворачивания ее в production среду. По результатам тестирования быстродействия было решено, что вполне достаточно развернуть 4 экземпляра модели.
> 
> Вас немного беспокоит вопрос, справится ли ваша модель в периоды пиковой нагрузки и не стоит ли увеличить то число до 6, но вы решили настроить политику развертывания таким образом, что модель будет автоматически масштабироваться до 6 экземпляров в случае пиковой нагрузки.
> 
> Вместе с тем вы понимаете, что конкуренты могут попробовать организовать DDoS атаку, чтобы скомпрометировать новый сервис и автоматическое масштабирование приведет с неоправданным тратам ресурсов за облачную инфраструктуру.

## Требования к масштабированию

### Автоматическое масштабирование

Из сказанного выше вытекает необходимость настройки незначительного масштабирования, которое покроет периоды пикового спроса и внедрение системы алертинга при дальнейшем росте нагрузки.

С помощью сервера Prometheus и Grafana вам нужно настроить мониторинг параметров работы Kubernetes кластера и уведомление системного администратора в случае превышения нагрузки на любом из 6 экземпляров модели выше 80%.

## Задания

Решение будет ожидаться в виде репозитория/ветки на GitHub, с terraform конфигурациями, k8s манифестами и другим необходимым кодом для запуска всей системы.

### Обязательные задания

1. **Настроить политику развертывания модели** в кластере Kubernetes от 4 до 6 экземпляров и развернуть модель.

2. **Настроить Apache AirFlow** на периодическое переобучение модели с фиксацией метрик в MLFlow. Для этого разверните AirFlow в кластере и подключите внешний git репозиторий с DAGами для него.

3. **Настроить сервер Prometheus** для мониторинга параметров кластера и качества работы вашей модели. Настройте отображение метрик в виде графиков с помощью Grafana.

4. **Настроить уведомление системного администратора** в случае разворачивания 6 экземпляров модели и превышении нагрузки на любой из них более 80% в течении 5 минут.

5. **Протестировать имитацию атаки** подняв сервис Apache Kafka из предыдущего задания и наращивания интенсивности потока событий до срабатывания алерта.

## Критерии оценки

Для получения положительной оценки за работу необходимо выполнить **все** из вышеприведенных заданий.

---

**Желаем успехов!** 